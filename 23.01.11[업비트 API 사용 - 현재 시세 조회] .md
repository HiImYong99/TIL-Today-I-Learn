# 23.01.11[ì—…ë¹„íŠ¸ API ì‚¬ìš© - í˜„ì¬ ì‹œì„¸ ì¡°íšŒ]

# ì˜¤ëŠ˜ í•œ ì¼ğŸ¤“

---

- ì´ì „ì— ë°°ìš´ ë‚´ìš©ì„ ë³µìŠµí•˜ê³ ì ì—…ë¹„íŠ¸ APIë¥¼ ì‚¬ìš©í•˜ì—¬ í˜„ì¬ ì‹œì„¸ë¥¼ í™•ì¸í•˜ëŠ” ê°„ë‹¨í•œ ì•± ì œì‘

---

# ê°œë°œì— ì‚¬ìš©ëœ ê¸°ëŠ¥ğŸ“–

---

[https://github.com/HiImYong99/iOS_Upbit_API_Practice](https://github.com/HiImYong99/iOS_Upbit_API_Practice)

- MVCíŒ¨í„´ì„ ì ìš©í•˜ì—¬ ì½”ë“œë¥¼ ì‘ì„±.

![Untitled](https://user-images.githubusercontent.com/97172787/211809170-90a375b0-c6c6-4327-bf0f-5dac0d2deb2e.png)


## **ViewController ì‘ì„±**

- Coinì„ ê³ ë¥´ê¸° ìœ„í•´ ì‚¬ìš©ëœ PickerViewì— ê¸°ëŠ¥ì„ í™•ì¥í•˜ê¸° ìœ„í•œ í•¨ìˆ˜ ì‘ì„±

```swift
//MARK: - UIPickerViewDataSource
extension ViewController: UIPickerViewDataSource {
    
    func numberOfComponents(in pickerView: UIPickerView) -> Int {
        return 1 // returní•˜ëŠ” Intì— ë”°ë¼ pickerViewì˜ ì—´ì´ ëŠ˜ì–´ë‚¨
    }
    
    func pickerView(_ pickerView: UIPickerView, numberOfRowsInComponent component: Int) -> Int {
        return coinArr.count // pickerView ì•ˆì— ë“¤ì–´ ê°ˆ ì½”ì¸ì˜ ê°œìˆ˜ë§Œí¼ pickerViewì˜ ë¹ˆì¹¸ì´ ìƒê¹€
    }
}
```

```swift
//MARK: - UIPickerViewDelegate
extension ViewController: UIPickerViewDelegate {
    
    func pickerView(_ pickerView: UIPickerView, titleForRow row: Int, forComponent component: Int) -> String? {
        return coinArr[row]
    }
    
    func pickerView(_ pickerView: UIPickerView, didSelectRow row: Int, inComponent component: Int) {
        coinName.text = coinArr[row]
        coinManager.fetchCoin(coinName: coinArr[row])
    }
    
}
```

- ì‹¤ì‹œê°„ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë°›ì•„ ì˜¤ê¸° ìœ„í•œ í•¨ìˆ˜ ì‘ì„±

```swift
//MARK: - CoinManagerDelegate
extension ViewController: CoinManagerDelegate{
    func didupdate(data: CoinData) {
        DispatchQueue.main.async {
            self.coinName.text = data.market
            let krwPrice = DecimalWon(value: data.trade_price)
            self.coinPrice.text = "\(krwPrice)"
        }
    }
    func error(error: Error) {
        print(error)
    }
}
```

## **CoinManager**

- urlì„ ì •ì˜ í•œ ë’¤ ë‹¤ë¥¸ í•¨ìˆ˜ì— urlì„ ê±´ë„¤ì¤€ë‹¤

```swift
func fetchCoin(coinName: String){
        let urlString = "\(coinURL)\(coinName)"
        performRequest(with: urlString)
    }
```

- ìœ„ í•¨ìˆ˜ë¥¼ í†µí•´ ì „ë‹¬ë°›ì€ urlì„ ì²˜ë¦¬í•˜ê³  JSON ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤. ì´ í•¨ìˆ˜ëŠ” ì „ì— ì‚¬ìš©ëœ ì˜ˆì œë¥¼ ì¸ìš©í•˜ì—¬ ì‚¬ìš©í•˜ì˜€ê³  ì•„ì§ í•¨ìˆ˜ì— ëŒ€í•´ ì™„ë²½íˆ ì´í•´í•˜ì§€ëŠ” ëª»í–ˆë‹¤.

```swift
func performRequest(with urlString: String) {
        if let url = URL(string: urlString){
            let session = URLSession(configuration: .default)
            let task = session.dataTask(with: url) {data, response, error in
                if error != nil {
                    delegate?.error(error: error!)
                    return
                }
                if let safeData = data {
                    if let coin = self.parseJSON(coinData: safeData) {
                        self.delegate?.didupdate(data: coin)
                    }
                }
            }
            task.resume()
        }
    }
```

- JSONì„ íŒŒì‹±í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.

ë§ˆì¼“ì˜ ì´ë¦„ê³¼ í˜„ì¬ ê°€ê²©ì„ ë°ì´í„°ë¡œ ê°–ê³ ì™”ë‹¤.

```swift
func parseJSON(coinData: Data) -> CoinData? {
        let decoder1 = JSONDecoder()
        do {
            let decodeData = try decoder1.decode([CoinData].self, from: coinData)
            let market = decodeData[0].market
            let price = decodeData[0].trade_price
            let coin = CoinData(market: market, trade_price: price)
            return coin
            
        } catch {
            delegate?.error(error: error)
            return nil
        }
        
    }
```

- ë¸ë¦¬ê²Œì´íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ Controlleì—ì„œ ê°™ì´ ì‚¬ìš© ë  í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ì˜€ë‹¤.

```swift
protocol CoinManagerDelegate {
    func didupdate(data: CoinData)
    func error(error: Error)
}
```

## **CoinModel**

- êµ¬ì¡°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì‹±í•  ë°ì´í„°ì˜ í‚¤ì™€ ë°ì´í„° ìœ í˜•ì„ ì •ì˜ í•˜ì˜€ë‹¤.

```swift
struct CoinData : Codable {
    let market: String
    let trade_price: Int
    
}
```

## **í…ŒìŠ¤íŠ¸**

![Simulator Screen Recording - iPhone 14 Pro - 2023-01-11 at 21 27 57](https://user-images.githubusercontent.com/97172787/211809206-f1248068-9c83-402f-8152-0ac145c59809.gif)


ì½”ì¸ì˜ í˜„ì¬ ì‹œì„¸ë¥¼ ê°€ì ¸ì˜¤ëŠ” ëª¨ìŠµì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.

---

# ì¼ê¸°â›…ï¸

---

ì˜¤ëŠ˜ì€ ì§€ê¸ˆê¹Œì§€ ë°°ìš´ ë‚´ìš©ì„ í† ëŒ€ë¡œ ì§ì ‘ ì—…ë¹„íŠ¸ APIë¥¼ í†µí•´ ì½”ì¸ì˜ ì‹œì„¸ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆëŠ” ê°„ë‹¨í•œ ê¸°ëŠ¥ì„ êµ¬í˜„í•´ ë³´ì•˜ë‹¤ ì—…ë¹„íŠ¸ APIë¡œ ë§Œë“¤ì–´ë³´ê³  êµ¬í˜„í•´ ë³´ê³  ì‹¶ì€ ê¸°ëŠ¥ë“¤ì´ ë„ˆë¬´ ë§ì•˜ì—ˆëŠ”ë° ë¹¨ë¦¬ ì‹¤ë ¥ì„ í‚¤ì›Œ ì—¬ëŸ¬ê°€ì§€ ê¸°ëŠ¥ì„ êµ¬í˜„ í•´ë³´ê³  ì‹¶ë‹¤

---
